---
import { getSelectionClasses, type SelectionProps as CoreSelectionProps } from "@corella/core-ui";

interface Props extends CoreSelectionProps {
  label?: string;
  wrapperClassName?: string;
  indeterminate?: boolean;
  name?: string;
  value?: string;
  required?: boolean;
  checked?: boolean;
  id?: string;
  hideControl?: boolean;
}

const {
  size = "medium",
  color = "primary",
  disabled = false,
  error = false,
  variant = "classic",
  label,
  wrapperClassName,
  className,
  checked,
  indeterminate,
  hideControl,
  id,
  ...props
} = Astro.props;

const { container, input, indicator } = getSelectionClasses({
  type: "checkbox",
  size,
  color,
  disabled,
  error,
  variant,
  hideControl,
  className: wrapperClassName,
});
---

<label class={container} for={id}>
  <div class="relative flex items-center">
    <input
      id={id}
      type="checkbox"
      class:list={[input, className]}
      disabled={disabled}
      checked={checked}
      {...props}
    />

    {/* Indicator: Checkmark or Dash */}
    <div class={indicator}>
      {
        indeterminate ? (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-full h-full">
            <path fill-rule="evenodd" d="M3 12a1 1 0 011-1h16a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
          </svg>
        ) : (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-full h-full">
            <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clip-rule="evenodd" />
          </svg>
        )
      }
    </div>
  </div>

  {/* Label Content */}
  {
    (label || Astro.slots.has("default")) && (
       <div class:list={["flex flex-col", variant === "card" ? "ml-1 w-full" : ""]}>
        {label && <span class:list={["text-base-content", variant === "card" ? "font-semibold mb-1" : ""]}>{label}</span>}
        <slot />
      </div>
    )
  }
</label>

{/* Handle Indeterminate via script if needed */}
{
  indeterminate && id && (
    <script define:vars={{ id }}>
      const el = document.getElementById(id);
      if (el) el.indeterminate = true;
    </script>
  )
}
